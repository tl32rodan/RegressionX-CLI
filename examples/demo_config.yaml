schema_version: 1

paths:
  workspace_root: "demo/work/{case_id}/{version}"
  artifacts_root: "demo/artifacts/{case_id}/{version}"

versions:
  baseline: "baseline"
  candidate: "candidate"

cmd_templates:
  preprocess: |
    python - <<'PY'
    from pathlib import Path
    root = Path('{workspace_root}')
    root.mkdir(parents=True, exist_ok=True)
    (root / 'note.txt').write_text('prep-{case_id}-{version}')
    script = root / 'run_demo.csh'
    script.write_text(
        "#!/bin/csh\n"
        "set artifacts_root=\"$1\"\n"
        "set case_id=\"$2\"\n"
        "set version_label=\"$3\"\n"
        "set nested_dir=\"$artifacts_root/outputs/$case_id/$version_label\"\n"
        "mkdir -p \"$nested_dir/detail\"\n"
        "echo \"${case_id}-${version_label}\" > \"$nested_dir/result.txt\"\n"
        "echo \"detail-${version_label}\" > \"$nested_dir/detail/info.txt\"\n"
        "set summary_dir=\"$artifacts_root/summary/$version_label\"\n"
        "mkdir -p \"$summary_dir\"\n"
        "echo \"summary-${case_id}-${version_label}\" > \"$summary_dir/summary.txt\"\n"
    )
    script.chmod(0o755)
    PY
  run: |
    csh {workspace_root}/run_demo.csh "{artifacts_root}" "{case_id}" "{version_label}"

filters:
  include:
    - "**/*"
  ignore:
    - "**/note.txt"
  extra_ignore_allowed: true

reporting:
  global_report: "demo/reports/global"
  case_report: "demo/reports/cases/{case_id}"
  formats: [json]

cases:
  - case_id: adder_case
    params:
      cell: adder
    metadata:
      owner: demo
  - case_id: multiplier_case
    params:
      cell: mult
    metadata:
      owner: demo
